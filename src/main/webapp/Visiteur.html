<!DOCTYPE html>
<html>
<head>
    <title>Visiteur</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- On charge jQuery -->
    <script	src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <!-- On charge le moteur de template mustache https://mustache.github.io/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"></script>
    <script>
        $(document).ready(// Exécuté à la fin du chargement de la page

        );

        function ShowCategories() {
            // On fait un appel AJAX pour chercher les codes
            $.ajax({
                url: "ShowCategories",
                dataType: "json",
                error: showError,
                success: // La fonction qui traite les résultats
                    function (result) {
                        // Le code source du template est dans la page
                        var template = $('#categorieTemplate').html();
                        // On combine le template avec le résultat de la requête
                        var processedTemplate = Mustache.to_html(template, result);
                        // On affiche la liste des options dans le select
                        $('#categorie').html(processedTemplate);
                    }
            });
        }

        // Fonction qui traite les erreurs de la requête
        function showError(xhr, status, message) {
            alert(JSON.parse(xhr.responseText).message);
        }

    </script>
    <!-- un CSS pour formatter la table -->
    <link rel="stylesheet" type="text/css" href="css/tableformat.css">
</head>
<body>
<div>
    <h1>Cette page utilise les servlets suivantes :</h1>
    <ul>
        <li><a href="ShowCategories" target="_blank">ShowCatergories : liste les catégories</a></li>
    </ul>
    La page utilise également le <a href="https://mustache.github.io/" target="_blank">moteur de template Mustache</a> pour formatter le résultat.<br>
    <hr>
</div>
<form >
    <input type="button" value="Afficher les catégories" onsubmit="event.preventDefault(); ShowCategories();">

     <!-- La zone où les résultats vont s'afficher -->
    <div id="categorie"></div>

    <!-- Le template qui sert à formatter la liste des codes -->
    <script id="categorieTemplate" type="text/template">
        <TABLE>
            <tr><th>Code</th><th>Taux</th><th>Action</th></tr>
            {{! Pour chaque enregistrement }}
            {{#records}}
            {{! Une ligne dans la table }}
            <TR><TD>{{libelle}}</TD><TD>{{description}}</TD>
                {{/records}}
        </TABLE>
    </script>
</form>
</body>
</html>
